#!/usr/bin/env bash

# keybindings
texted_mode="Alt+t"
copy_mode="Alt+c"
clean_mode="Alt+n"
provide_mode="Alt+p"
clear_palettes="Alt+C"
clean_dir="Alt+N"

highlightcolor='Aqua'

# load configs
. "$HOME/.config/rofi/script-configs/rofi-iro.conf"

opts=""

_rofi() {
  rofi -sep '|' -columns 8 -lines 1 -disable-history true -cycle true \
    -theme rofi-smallmenu.rasi -location 5 -width 400 -height 20 \
    -dmenu -font "Hack Nerd Font 10" "$@"
}

activateTextedMode() {
  opts=""
}

activateCopyMode() {
  opts="-c"
}

activateCleanMode() {
  opts="-n"
}

activateProvideMode() {
  opts="-p"
}

printKey() {
  echo "<span color='${highlightcolor}'>($1)</span>"
}

getOptionMessage() {
  local mesg=""
  case "${opts}" in
    "") mesg="ïƒ½ texted mode" ;;
    "-c") mesg="ïƒ… copy mode" ;;
    "-n") mesg="ïƒˆ clean mode" ;;
    "-p") mesg="ï€‰ provide mode" ;;
  esac

  echo $mesg
}

ðŸ’¬() {
  local mesg=""
  case "${opts}" in
    "") mesg="ïƒ… $(printKey ${copy_mode}) | ïƒˆ $(printKey ${clean_mode}) | ï€‰ $(printKey ${provide_mode})" ;;
    "-c") mesg="ïƒ½ $(printKey ${texted_mode}) | ïƒˆ $(printKey ${clean_mode}) | ï€‰ $(printKey ${provide_mode})" ;;
    "-n") mesg="ïƒ½ $(printKey ${texted_mode}) | ïƒ… $(printKey ${copy_mode}) | ï€‰ $(printKey ${provide_mode})" ;;
    "-p") mesg="ïƒ½ $(printKey ${texted_mode}) | ïƒ… $(printKey ${copy_mode}) | ïƒˆ $(printKey ${clean_mode})" ;;
  esac

  echo $mesg
}

main() {
  choices="hex|rgb"
  mesg="ðŸŽ¨ <b>iro</b> - $(getOptionMessage)
$(ðŸ’¬)
$(printKey ${clear_palettes}) to clear palettes
$(printKey ${clean_dir}) to clean cache"
  choice=$(echo -n "${choices}" | _rofi \
    -mesg "${mesg}"  \
    -kb-custom-1 "${texted_mode}" -kb-custom-2 "${copy_mode}" -kb-custom-3 "${clean_mode}" \
    -kb-custom-4 "${provide_mode}" -kb-custom-5 "${clear_palettes}" -kb-custom-6 "${clean_dir}")
  retval=$?
  case "${retval}" in
    1) exit 0 ;;
    10) activateTextedMode && main ;;
    11) activateCopyMode && main ;;
    12) activateCleanMode && main ;;
    13) activateProvideMode && main ;;
    14) iro clear ;;
    15) iro clean ;;
    0)
      if [ ${opts} = "-p" ]; then
        color=$(rofi -dmenu -i -p "Please provide ${choice} color")
        retvall=$?
        case "${retval}" in
          0) iro ${opts} ${choice} ${color} ;;
        esac
      else
        iro ${opts} ${choice}
      fi
      ;;
  esac
}

main

# choice=$(echo -en "hex ïƒ½|rgb ïƒ½|hex ïƒ…|rgb ïƒ…|hex ïƒˆ|rgb ïƒˆ|hex ï€‰ only|rgb ï€‰ only|clear|clean" | _rofi)
# retval=$?
# if [ $retval != "1" ]; then
#   case "$choice" in
#     "clear" | "clean") iro "$choice" ;;
#     "hex ïƒ½" | "rgb ïƒ½") iro "$(echo $choice | cut -d' ' -f1)" ;;
#     "hex ïƒ…" | "rgb ïƒ…") iro -c "$(echo $choice | cut -d' ' -f1)" ;;
#     "hex ïƒˆ" | "rgb ïƒˆ") iro -n "$(echo $choice | cut -d' ' -f1)" ;;
#     "hex ï€‰ only") provideColor "hex" ;;
#     "rgb ï€‰ only") provideColor "rgb" ;;
#   esac
# fi
